<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <meta name="author" content="Maxim Sokhatsky" />
    <title>2020-02-03</title>
    <link rel="stylesheet" href="https://n2o.dev/blank.css" />
    <link rel="stylesheet" href="../../journal.css" />
</head>
<body>
<nav>
    <a href='../../index.html'>5HT</a>
    <a href='../index.html'>TOP</a>
    <a href='#'>2020-02-03</a>
</nav>
<main>
    <section>
        <h3>–ö–≤–∞–ª—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π –ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∏–π –ü—ñ–¥–ø–∏—Å</h3>

        <p>–ö–≤–∞–ª—ñ—Ñ—ñ–∫–æ–≤–∞–Ω–∏–π –ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∏–π –ü—ñ–¥–ø–∏—Å, –∞–±–æ –ö–≤–∞–ª—ñ—Ñ—ñ–∫–ª–æ–≤–∞–Ω–∞ –ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ü–µ—á–∞—Ç–∫–∞ ---
           —Ü–µ –Ω–∞–±—ñ—Ä —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ñ–≤ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ—ñ—á–Ω–æ–≥–æ –∑–∞—Ö–∏—Å—Ç—É –î–°–¢–£ 4145,
           —Ç–∞ –º—ñ–∂–Ω–∞—Ä–æ–¥–Ω–∏—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ñ–≤ —è–∫—ñ –≤–∏–∑–Ω–∞—á–∞—é—Ç—å –π–æ–≥–æ –∫–æ–Ω–≤–µ—Ä—Ç: X.501, X.509, X.511, X.520.</p>

        <p>–°–µ—Ä—ñ—è –º—ñ–∂–Ω–∞—Ä–æ–¥–Ω–∏—Ö —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ñ–≤ X.500, –≥—Ä—É–ø—É—î—Ç—å—Å—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è–º, –∫–æ–∂–Ω–∞
           –∑ —è–∫–∏—Ö –º–∞—î —Å–≤—ñ–π –ø–µ—Ä–µ–ª—ñ–∫ ASN.1 —Ñ–∞–π–ª—ñ–≤. –ê–±–∏ –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏ —É—Å—ñ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ
           –¥–ª—è –ö–ï–ü –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ –Ω–∞—Å—Ç—É–ø—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ñ–≤ (–≤–∏–¥—ñ–ª–µ–Ω—ñ –±–æ–ª–¥–æ–º):
            X.501 ---
<a href="https://www.itu.int/ITU-T/formal-language/itu-t/x/x501/2019/BasicAccessControl.html"><b>BasicAccessControl</b></a>,
<a href="https://www.itu.int/ITU-T/formal-language/itu-t/x/x501/2019/InformationFramework.html"><b>InformationFramework</b></a>,
<a href="https://www.itu.int/ITU-T/formal-language/itu-t/x/x501/2019/UsefulDefinitions.html"><b>UsefulDefinitions</b></a>;
X.509 ---
<a href="https://www.itu.int/ITU-T/formal-language/itu-t/x/x509/2019/ExtensionAttributes.html">SpkmGssTokens</a>,
<a href="https://www.itu.int/ITU-T/formal-language/itu-t/x/x509/2019/PkiPmiExternalDataTypes.html">PkiPmiExternalDataTypes</a>,
<a href="https://www.itu.int/ITU-T/formal-language/itu-t/x/x509/2019/AttributeCertificateDefinitions.html">AttributeCertificateDefinitions</a>,
<a href="https://www.itu.int/ITU-T/formal-language/itu-t/x/x509/2019/AlgorithmObjectIdentifiers.html">AlgorithmObjectIdentifiers</a>,
<a href="https://www.itu.int/ITU-T/formal-language/itu-t/x/x509/2019/AuthenticationFramework.html"><b>AuthenticationFramework</b></a>,
<a href="https://www.itu.int/ITU-T/formal-language/itu-t/x/x509/2019/CertificateExtensions.html"><b>CertificateExtensions</b></a>;
X.511 ---
<a href="https://www.itu.int/ITU-T/formal-language/itu-t/x/x511/2019/SpkmGssTokens.html">SpkmGssTokens</a>,
<a href="https://www.itu.int/ITU-T/formal-language/itu-t/x/x511/2019/DirectoryAbstractService.html"><b>DirectoryAbstractService</b></a>,
X.520 ---
<a href="https://www.itu.int/ITU-T/formal-language/itu-t/x/x520/2019/PasswordPolicy.html">PasswordPolicy</a>,
<a href="https://www.itu.int/ITU-T/formal-language/itu-t/x/x520/2019/UpperBounds.html"><b>UpperBounds</b></a>,
<a href="https://www.itu.int/ITU-T/formal-language/itu-t/x/x520/2019/SelectedAttributeTypes.html"><b>SelectedAttributeTypes</b></a>.
         –ú–æ–∂–Ω–æ –±—É–ª–æ –±–∏ –≤–∏–Ω–µ—Å—Ç–∏ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –æ–¥—Ä–∞–∑—É –≤ <a href="https://github.com/synrc/ca/blob/master/priv/kep/KEP.asn1">KEP.asn1</a>, –æ–¥–Ω–∞–∫
         —Ü–∏–º —Ö–æ—Ç—ñ–ª–æ—Å—è –ø—ñ–¥–∫—Ä–µ—Å–ª–∏—Ç–∏ —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å –∑ –º—ñ–∂–Ω–∞—Ä–æ–¥–Ω–∏–º–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º–∏. –û–∫—Ä—ñ–º —Å–µ—Ä—ñ—ó
         –ø—Ä–æ—Ç–æ–∫–æ–ª—ñ–≤ X.500, –ö–ï–ü —â–µ –≤–∏–∑–Ω–∞—á–∞—î —Ç–∞–∫–æ–∂ –∑–∞–ø–∏—Ç–∏ —Ç–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ OCSP, —Ç–∞–∫–æ–∂ —É ASN.1 —Ñ–æ—Ä–º–∞—Ç—ñ.
         </p>

         <p>–ù–∞ –≤—ñ–¥–º—ñ–Ω—É –≤—ñ–¥ —Å–∞–º–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º—É –ö–ï–ü, —è–∫–∏–π –≤–∏–∑–Ω–∞—á–µ–Ω–æ –î–°–¢–£ 4145,
            –∫–æ–Ω–≤–µ—Ä—Ç–∏ –≤–∏–∑–Ω–∞—á–∞—é—Ç—å—Å—è –Ω–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º–∏, –∞ –Ω–∞–∫–∞–∑–∞–º–∏ –º—ñ–Ω—ñ—Å—Ç–µ—Ä—Å—Ç–≤–∞ —é—Å—Ç–∏—Ü—ñ—ó:
         <a href="http://www.dsszzi.gov.ua/dsszzi/control/uk/publish/article?art_id=77726">–ü—Ä–æ–µ–∫—Ç –Ω–∞–∫–∞–∑—É –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ü—ñ—ó –î–µ—Ä–∂—Å–ø–µ—Ü–∑–≤'—è–∑–∫—É —Ç–∞ –î–µ—Ä–∂–∫–æ–º—ñ–Ω—Ñ–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó (2009)</a>,
         <a href="https://zakon.rada.gov.ua/laws/show/z1401-12">–ù–∞–∫–∞–∑ –ú—ñ–Ω—ñ—Å—Ç–µ—Ä—Å—Ç–≤–∞ —é—Å—Ç–∏—Ü—ñ—ó –£–∫—Ä–∞—ó–Ω–∏ 1236/5/453</a>.
         –ö–µ—Ä—É—é—á–∏—Å—å —Ü–∏–º–∏ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω–∏–º–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏ –±—É–ª–æ —Å—Ç–≤–æ—Ä–µ–Ω–æ —Ñ–∞–π–ª <a href="https://github.com/synrc/ca/blob/master/priv/kep/KEP.asn1">KEP.asn1</a>,
         —è–∫–∏–π —î –æ–¥–Ω–∏–º –∑ —Ç—Ä—å–æ—Ö top-level —Ñ–∞–π–ª—ñ–≤ –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏—ó –¥–ª—è –∫–æ–º–ø—ñ–ª—è—Ü—ñ—ó ASN.1 –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä–æ–º.
         </p>

         <p>–Ü—Å–Ω—É—î –Ω–µ–±–∞–≥–∞—Ç–æ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏—Ö —Ç–∞ –ø–æ–≤–Ω–∏—Ö –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä—ñ–≤ (–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ñ–≤ –ø–∞—Ä—Å–µ—Ä—ñ–≤)
            ASN.1 —Å–ø–µ—Ü–∏—Ñ—ñ–∫–∞—Ü—ñ–π. Erlang —î –ø—Ä–∏–∫–ª–∞–¥–æ–º —Å–∏—Å—Ç–µ–º–∏, –¥–æ —Å–∫–ª–∞–¥—É —è–∫–æ—ó –≤—Ö–æ–¥–∏—Ç—å
            –ø–µ—Ä—à–æ–∫–ª–∞—Å–Ω–∏–π –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π –∑ –≤—ñ–¥–∫—Ä–∏—Ç–æ—é –ª—ñ—Ü–µ–Ω—Ü—ñ—î—é ASN.1 –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä, –¥–µ
            —Ñ–∞–π–ª–∏ –≤ ASN.1 –Ω–æ—Ç–∞—Ü—ñ—ó –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∑–∫–æ–º–ø—ñ–ª—å–æ–≤–∞–Ω—ñ –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ Erlang –∫–æ–º–ø—ñ–ª—è—Ç–æ—Ä–æ–º:</p>
         <figure><code> $ erlc AuthenticationFramework.asn1
 $ erlc InformationFramework.asn1
 $ erlc KEP.asn1</code></figure>
         <p>–°—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ–∞–π–ª –ø—ñ–¥–ø–∏—Å—É PKCS-7 –º–æ–∂–Ω–∞ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –±—É–¥—å —è–∫–æ—ó –ø—Ä–æ–≥—Ä–∞–º–∏ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–æ—ó –≤ –£–∫—Ä–∞—ó–Ω—ñ.
            –ù–∞–π–ø—Ä–æ—Å—Ç—ñ—à–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ —Å–≤–æ—é –ö–ï–ü –ø–µ—á–∞—Ç–∫—É –±—É–¥—É—á–∏ –∫–ª—ñ—î–Ω—Ç–æ–º –ü—Ä–∏–≤–∞—Ç–ë–∞–Ω–∫—É. –ó–∞ –¥–æ–ø–æ–º–æ–≥–æ—é
            "–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –¶–°–ö" –∫–æ–º–ø–∞–Ω—ñ—ó –Ü–Ü–¢ –≤–∏ –º–æ–∂–µ—Ç–µ –ø—ñ–¥–ø–∏—Å—É–≤–∞—Ç–∏ —Ñ–∞–π–ª–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω—É
            —Ñ–æ—Ä–º—É –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ —É –≤–∏–≥–ª—è–¥—ñ –∑–≤–∏—á–∞–π–Ω–æ–≥–æ —Ñ–∞–π–ª—É.</p>
         <p>–©–æ–± –ø–æ–∫–∞–∑–∞—Ç–∏ —è–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ç–∏—Å—è –ö–ï–ü, —Ç–∞ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –∞—Ç—Ä–∏–±—É—Ç–∏–≤–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –∑ —Å–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç—É,
            —è–∫–∏–π –≤—à–∏—Ç–∏–π –≤ PCKS-7 –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ—ñ—á–Ω–∏–º –ø—ñ–¥–ø–∏—Å–æ–º, –ø–æ–∫–∞–∂–µ–º–æ 5 —Ñ—É–Ω–∫—Ü—ñ–π:</p>
         <figure><code>
  Record.defrecord(:certAttrs,
     serial: "", cn: "", givenName: "", surname: "",
     o: "", title: "", ou: "", c: "", locality: "")

  def extract(code, person) do
    case :lists.keyfind(code, 2, person) do
      false -> ""
      {_, _, {:printable, str}} -> str
      {_, _, {:utf8, str}} -> str
    end
  end

  def parseSignData(bin) do
    {_, {:ContentInfo, _, ci}} = :KEP.decode(:ContentInfo, bin)
    {:ok, {:SignedData, _, alg, x, c, x1, x2}} = :KEP.decode(:SignedData, ci)
    parseSignDataCert({alg,x,c,x1,x2})
  end

  def parseSignDataCert({_,_,:asn1_NOVALUE,_,_}), do: []
  def parseSignDataCert({_,_,[cert],_,_}), do: parseCert(cert)

  def parseCert(cert) do
    {:Certificate, a, _, _} = cert
    {:Certificate_toBeSigned, _, _, _, issuer, _, issuee, _, _, _, _} = a
    person = :lists.flatten(:erlang.element(2, issuee))
    ca = :lists.flatten(:erlang.element(2, issuer))
    {parseAttrs(person),parseAttrs(ca)}
  end

  def parseAttrs(attrs) do
    certAttrs(
      o: extract({2, 5, 4, 10}, attrs),
      ou: extract({2, 5, 4, 11}, attrs),
      title: extract({2, 5, 4, 12}, attrs),
      cn: extract({2, 5, 4, 3}, attrs),
      givenName: extract({2, 5, 4, 42}, attrs),
      surname: extract({2, 5, 4, 4}, attrs),
      locality: extract({2, 5, 4, 7}, attrs),
      serial: extract({2, 5, 4, 5}, attrs),
      c: extract({2, 5, 4, 6}, attrs)
    )
  end
</code></figure>
         <p>–£ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ –æ—Ç—Ä–∏–º—É—î–º–æ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –≤–∏—Å–æ–∫–æ—Ä—ñ–≤–Ω–µ–≤–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å:</p>
         <figure><code> > {:ok,bin} = :file.read_file("priv/5HT.p7s")
 > KEP.parseSignData bin
 {{:certAttrs, "1786046", "–°–û–•–ê–¶–¨–ö–ò–ô –ú–ê–ö–°–ò–ú –ï–†–û–¢–ï–ô–û–í–ò–ß",
   "–ú–ê–ö–°–ò–ú –ï–†–û–¢–ï–ô–û–í–ò–ß", "–°–û–•–ê–¶–¨–ö–ò–ô",
   "–°–û–•–ê–¶–¨–ö–ò–ô –ú–ê–ö–°–ò–ú –ï–†–û–¢–ï–ô–û–í–ò–ß",
   "–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–µ—á–∞—Ç–∫–∞", "", 'UA', "–ö–ò–á–í"},
  {:certAttrs, "UA-14360570-2018", "–ê–¶–°–ö –ê–¢ –ö–ë ¬´–ü–†–ò–í–ê–¢–ë–ê–ù–ö¬ª",
   "", "",
   "–ê–ö–¶–Ü–û–ù–ï–†–ù–ï –¢–û–í–ê–†–ò–°–¢–í–û –ö–û–ú–ï–†–¶–Ü–ô–ù–ò–ô –ë–ê–ù–ö ¬´–ü–†–ò–í–ê–¢–ë–ê–ù–ö¬ª",
   "", "–ê–¶–°–ö", 'UA', "–ö–∏—ó–≤"}}</code></figure>
    </section>
    <p>–î–∞–Ω–∏–π –∫–æ–¥ –º–æ–∂–Ω–∞ –∑–Ω–∞–π—Ç–∏ —è–∫ —á–∞—Å—Ç–∏–Ω—É –Ω–∞—à–æ—ó <a href="https://github.com/synrc/ca">synrc/ca</a> –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏:
   üõ°Ô∏è CA: Certificate Authority ‚Äî <a href="https://ca.erp.uno">ca.erp.uno</a></p>
</main>
<footer>Namdak Tonpa <span class="heart">&nbsp;‚ù§&nbsp;</span> 2009‚Äî2021</footer>
</body>
</html>
