<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <meta name="author" content="Maxim Sokhatsky" />
    <title>2021-12-23</title>
    <link rel="stylesheet" href="https://n2o.dev/blank.css" />
    <link rel="stylesheet" href="../../journal.css" />
</head>
<body>
<nav>
    <a href='../../index.html'>5HT</a>
    <a href='../index.html'>TOP</a>
    <a href='#'>2021-12-23</a>
</nav>
<main>
    <section>
        <h3>Аудио</h3>

          <p>TLDR; В этой статье пойдёт речь об основах цифровой обработки сигнала,
             а также способах построения аудио-систем для вопроизведения звука.</p>

        <p>&mdash; PCM и DSD форматы<br>
           &mdash; Структура аудио-тракта<br>
           &mdash; Устранение ошибок<br>
           &mdash; Чистый DSD тракт<br>
           </p>


        <h3>PCM и DSD форматы</h3>

            <p>Главным образом цифровая обработка сигнала основывается на двух форматах представления данных:
               PCM для данных записанных с помощью импульсно-кодовой модуляции (ИКМ),
               а также DSD для данных записанных с помошью широтно-импульсной модуляции (ШИМ) с частотно-зависимой отрицательной обратной связью.</p>


            <p>В отличие от ИКМ, ШИМ позволяет использовать при этих операциях обработки звукового сигнала
               достаточно грубые преобразователи с числом разрядов вплоть до одного, обеспечивая при этом
               отношение сигнал шум (SNR) до 120...140 дБ, что необходимо для профессиональной записи звука.</p>

            <p>При ШИМ DSD, чем ниже частота звукового сигнала, тем больше выборок на его период и наоборот,
               чем выше частота, тем меньше выборок на ее период. В соответствии с теоремой Найквиста верхней граничной
               частоте соответствуют две выборки на ее период и двухуровневое квантование. Для рассматриваемой ШИМ,
               это условие соответствует временному интервалу, в котором происходят две выборки на период звукового сигнала.
               Этот интервал равен 8 тактам. Это значит, что частота Найквиста при ШИМ меньше f<sub>sk</sub> в 8 раз, а не в 2 как для ИКМ.
               Поэтому чтобы закодировать диапазон 20КГц нужно нужно в 4 раза больший битрейт.</p>

        <p><img src="img/image_2021-12-23_07-26-31.jpg" width=400>
           <img src="img/image_2021-12-23_07-26-51.jpg" width=400></p>

        <p>В действительности такие понятия как объм и чистота сцены зависят от импульсной характеристики
           (выходной сигнал динамической системы как реакция на входной сигнал в виде дельта-функции Дирака),
            которую можно проверить задав на входе -6db на протяжении 3 микросекунд и посмотрев на график.</P>

        <figure><img src="img/ImpulseResponse.png"></figure>

        <p>Важной отличительной особенностью сигма дельта модуляции является одновременное использование
           трёх аудио технологий: dithering, oversampling и noise shaping. С помощью этих технологий
           ошибки квантования преобразуются в шум, спектр шума расширяется в область ультразвуковых
           частот и преобразуется так, что его спектральная плотность мощности в звуковом диапазоне
           сильно уменьшается, а в области высоких частот далеко за пределами частоты Найквиста увеличивается.</P>

        <h3>Структура тракта</h3>

<figure><code>                    ADC                                    DAC
            +-----------------+                    +-----------------+
+-----+     | +-----+ +-----+ |     +--------+     | +-----+ +-----+ |     +---------+
| Mic |-[M]-|-| DSD |-| PCM |-|-[I]-| EDITOR |-[T]-|-| PCM |-| DSD |-|-[S]-| Speaker |
+-----+     | +-----+ +-----+ |     +--------+     | +-----+ +-----+ |     +---------+
            +-----------------+                    +-----------------+
</code></figure>

        <h4>PCM DAC</h4>

        <h4>Резисторные лестницы</h4>

        <P>Первые DSD DAC были построены на основе резистивной матрицы постоянного
           импеданса (резисторной лестницы R-2R). Такие DAC имеют проблемы с
           нелинейностью из-за допусков резисторов: нелинейность вызывает искажения.
           Кроме того, при ультразвуковом воздействии могут возникать звуковые
           наложения, ухудшающие качество звука.</p>

        <h4>1-битные ΣΔ-модуляторы</h4>

        <p>В отличие от импульсно-кодовой модуляции сигма-дельта модуляция работает на
           частоте дискретизации в 4 и более раз выше стандартного значения, соответствующего
           требованиям теоремы Найквиста. В них используются грубые квантователи с
           числом разрядовq от 1 до 6 с частотно-зависимой отрицательной обратной связью.</P>

<figure><code>
             1/s    | E(s)
      +---+ +---+ +-+-+   +--------+
X(s) -| Σ |-| I |-| Q |-+-| FILTER |- Y(s)
      +-+-+ +---+ +---+ | +--------+
        |               |
        +---------------+
</code></figure>

        <p>Количество интеграторов и соотвественно количество обратных связей определяют порядок
           ΣΔ-модулятора. </p>

<figure><code>                             | E
   +---+ +---+ +---+ +---+ +-+-+   +--------+
X -| Σ |-| I |-| Σ |-| I |-| Q |-+-| FILTER |- Y
   +-+-+ +---+ +-+-+ +---+ +---+ | +--------+
     |           |               |
     +-----------+---------------+
</code></figure>

        <p>Ниже приведен пример 1-битного модулятора 5-го порядка, который использовался в стандарте SACD.</p>

<figure><code>
   +---+ +---+ +---+   +---+ +---+   +---+ +---+   +---+ +---+   +---+ +---+
X -| Σ |-| Σ |-| I |-+-| Σ |-| I |-+-| Σ |-| I |-+-| Σ |-| I |-+-| Σ |-| I |-+
   +-+-+ +-+-+ +---+ | +-+-+ +---+ | +-+-+ +---+ | +-+-+ +---+ | +-+-+ +---+ |
     |     |         |   |         |   |         |   |         |   |         |
     |     +---------+   +---------+   +---------+   +---------+   +---------+
     |               |             |             |             |             |
     |               +-------------+-------------+-------------+-------------+
     |                                           |    +---+
     |                                           +----| Q |----+----- Y
     |                                                +---+    |
     +---------------------------------------------------------+
</code></figure>

        <p>Повышение порядка интегратора существенно улучшает SNR в области низких частот,
           так например для модулятор 7-го порядка уровнем шума в слышимом диапазоне не превышает -140дБ.
           В практике уже есть разработки модуляторов до 12 порядка.</p>

        <figure><img src="img/SNR.PNG"></figure>

        <h4>Мультибитные модуляторы</h4>

        <p>Мультибитный DSD вцелом похож на мультибитный PCM но отличается от него рядом
           признаков. PCM обычно содержит 24 бита для всего сэмпла, в то время как DSD
           хранит 5-6 битную разницу между сосденими сэмплами. В 1-битном модуляторе
           эта разница всегда бинарна (0 или 1), в то время как в мультибитном модуляторе
           эта разница равна разрядности модулятора. Мультибитные модуляторы всегда
           лучше однобитных по своим характеристикам поэтому являются естественной эволюцией однобитных.
           В начале 2000-х годов 1-битное преобразование привлекало простотой (теоретически идеальной линейностью).
           Теперь мы можем разрешить себе больше производительности и мультибитные DSD DAC,
           чтобы лучше разобрать детали. Однако поскольку мультибитные DSD DAC напоминают
           по своей архитектуре мультибитные PCM DAC, нам придется расплатиться за мультибитность дополнительными фильтрами.</p>

        <h3>Устранение шумов</h3>

        <h4>Oversampling</h4>

        <p>Технология oversampling [X] заключается в применении частоты дискретизации f<sub>sk</sub> во
           много раз выше частоты sf, удовлетворяющей требованиям теоремы Найквиста.</p>

        <h4>Dithering</h4>

        <p>Технология Dithering осуществляет декорреляцию ошибок квантования и тем самым
           преобразует дискретный спектр ошибок в спектр белого шума квантования.
           Такое преобразование осуществляется путем добавления на вход квантователя [Q]
           вместе с аналоговым звукового сигнала дополнительного шума небольшого уровня от качественного генератора псевдослучайных чисел.</p>

        <h4>Noise shaping</h4>

        <p>Технология Noise Shaping заключается в применении квантователя с отрицательной
           обратной связью и интегратором на его входе. Интегратор создает частотную зависимость
           шума квантования. При этом изменяется спектр шума квантования таким образом, что
           мощность шума в звуковом диапазоне уменьшается, а за пределами этого диапазона увеличивается.
           Такое изменение спектра шума сопровождается, к сожалению, значительным увеличением общей
           мощности шума квантования, о чем, обычно, умалчивается.</p>

        <h4>Decimation</h4>

        <h4>Dynamic Element Matching</h4>

        <h3>Чистый DSD тракт</h3>

<figure><code>              ADC         DSD/PCM        DAC
+-----+     +-----+     +--------+     +-----+     +---------+
| Mic |-[M]-| DSD |-[I]-| EDITOR |-[T]-| DSD |-[S]-| Speaker |
+-----+     +-----+     +--------+     +-----+     +---------+
</code></figure>

<figure><code>
                 DAC
+--------+     +-----+     +---------+
| PLAYER |-[T]-| DSD |-[S]-| Speaker |
+--------+     +-----+     +---------+

</code></figure>

        <h4>DIY компонентные DSD ЦАП</h4>

        <p>Одним из громких и успешных примеров минималистичного чистого DSD тракта является
           проект DSC2 Pure DSD Павла Погодина, который получил положительные отзывы еще одного
           инженера аудиофила Андреа Чуффоли (Andrea Ciuffoli).

        <figure><img src="img/DSC2.PNG"></figure>

        <p>Под присмотром Андреа во Вьетнаме также налажено производство таких чистых цифровых
           DSD плееров по цене от $1200. Ребята обещают прослушать и протестировать собраный экземпляр.</p>

        <figure><img src="img/star-pure-dsd.jpg"></figure>

        <h4>DIY DSD ЦАП на FPGA</h4>

        <p>Рынок FPGA DAC небольшой, но все учасники рынка представляют собой уверенных представилей в Hi-End аудио:
           PS Audio, Chord Electronics, Exogal, Playback Designs, dCS, Holo Audio и возможно другие.</p>

        <p>Есть также аматорские решения как приложения для RISC-V платформы, такие
           как <a href="https://www.youtube.com/watch?v=RsP_T7GeWYM">12MHz 1-bit DSD DAC</a> от René Rebe bkb. </p>

        <h4>ASIC микросхемы с Direct DSD режимом</h4>

        <p>Самые популярные микросхемы с полным набором функциональности для PCM и DSD ЦАП сводятся к трем производителям:
           Burr Brown (Texas Instruments), AKM (Asahi Kasei), ESS (Sabre), Wolfson Microelectronics (Cirrus Logic).<p>

        <p>Direct DSD Bypass Mode был только в чипах AK4499 (на самом деле во многих TDA1547,
           PCM1792, DSD1793, AK4493, AK4497, но топовый AK4499), а у них сгорел завод. Поэтому
           многие перешли на чипы Sabre. А там нет режима Direct DSD Bypass. Сообщают, что АК4499 появится не раньше 2023.</p>

    </section>
</main>
<footer>Namdak Tonpa <span class="heart">&nbsp;❤&nbsp;</span> 2009—2021</footer>
</body>
</html>
